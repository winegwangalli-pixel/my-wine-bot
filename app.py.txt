import streamlit as st
import pandas as pd
import google.generativeai as genai

# 1. API í‚¤ ì„¤ì • (ë”°ì˜´í‘œ ì•ˆì— ë„£ìœ¼ì„¸ìš”)
GOOGLE_API_KEY = "AIzaSyC0Ldeu8mqgaFwKnSCDjwzHSxJrg50loQg"
# 2. êµ¬ê¸€ ì‹œíŠ¸ CSV ì£¼ì†Œ (ì‹œíŠ¸ ID ë¶€ë¶„ì„ ì‚¬ì¥ë‹˜ ê²ƒìœ¼ë¡œ ë°”ê¾¸ì„¸ìš”)
# ì‹œíŠ¸ ìƒë‹¨ ì£¼ì†Œì°½ì—ì„œ d/ì™€ /edit ì‚¬ì´ì˜ ê¸´ ë¬¸ìì—´ì´ ì‹œíŠ¸ IDì…ë‹ˆë‹¤.
SHEET_ID = "1-0-rK8a0_GEK4zXUcNmvkb0pnXIK4To2SnzW2rErglo/edit?gid=0#gid=0"
SHEET_URL = f"https://docs.google.com/spreadsheets/d/{SHEET_ID}/export?format=csv"

genai.configure(api_key=GOOGLE_API_KEY)

st.set_page_config(page_title="AI ì†Œë¯ˆë¦¬ì—", page_icon="ğŸ·")

# ë””ìì¸ ê¾¸ë¯¸ê¸°
st.title("ğŸ· ìš°ë¦¬ë§¤ì¥ AI ì†Œë¯ˆë¦¬ì—")
st.markdown("---")

# ì§ˆë¬¸ ì…ë ¥ì°½
query = st.text_input("ì™€ì¸ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”!", placeholder="ì˜ˆ: ì‚¼ê²¹ì‚´ì´ë‘ ì–´ìš¸ë¦¬ëŠ” 3ë§Œì›ëŒ€ ì™€ì¸ ì¶”ì²œí•´ì¤˜")

if query:
    with st.spinner('ì¬ê³ ë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...'):
        try:
            # ì‹œíŠ¸ ë°ì´í„° ì½ê¸°
            df = pd.read_csv(SHEET_URL)
            inventory = df.to_string(index=False)
            
            # AI ëª¨ë¸ ì„¤ì • (í™•ì¸í•˜ì‹  gemini-3-flash-preview ì‚¬ìš©)
            model = genai.GenerativeModel("gemini-1.5-flash") # gemini-3-flash-previewê°€ ì˜¤ë¥˜ë‚˜ë©´ ì´ê±¸ë¡œ ë¨¼ì € í…ŒìŠ¤íŠ¸
            
            prompt = f"""ë„ˆëŠ” ì™€ì¸ ë§¤ì¥ì˜ ì¹œì ˆí•œ ì†Œë¯ˆë¦¬ì—ì•¼. ì•„ë˜ [ë§¤ì¥ ì¬ê³  ë°ì´í„°]ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§ˆë¬¸ì— ë‹µí•´ì¤˜.
            
[ë§¤ì¥ ì¬ê³  ë°ì´í„°]
{inventory}

[ê³ ê° ì§ˆë¬¸]
{query}

[ë‹µë³€ ê·œì¹™]
1. ì¬ê³ ê°€ ìˆëŠ” ê²ƒë§Œ ì¶”ì²œí•  ê²ƒ.
2. ì¹œì ˆí•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ 3ì¤„ ë‚´ì™¸ë¡œ ë‹µí•  ê²ƒ."""

            response = model.generate_content(prompt)
            
            # ë‹µë³€ ì¶œë ¥
            st.success("âœ¨ AI ì†Œë¯ˆë¦¬ì—ì˜ ë‹µë³€")
            st.write(response.text)
            
        except Exception as e:
            st.error(f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")

st.markdown("---")
st.caption("ì‹¤ì‹œê°„ ì¬ê³  í˜„í™©ì„ ë°”íƒ•ìœ¼ë¡œ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.")
