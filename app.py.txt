import streamlit as st
import pandas as pd
import google.generativeai as genai

# 1. ì„¤ì • (ì—¬ê¸°ì— ì‚¬ì¥ë‹˜ ì •ë³´ë¥¼ ë„£ìœ¼ì„¸ìš”)
GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/ì‹œíŠ¸ID/export?format=csv"
genai.configure(api_key="ì‚¬ì¥ë‹˜ì˜_API_KEY")

# 2. ì›¹í˜ì´ì§€ ë””ìì¸
st.set_page_config(page_title="ìš°ë¦¬ë§¤ì¥ AI ì†Œë¯ˆë¦¬ì—", page_icon="ğŸ·")
st.title("ğŸ· AI ì†Œë¯ˆë¦¬ì— ì¶”ì²œ")
st.markdown("ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì´ë‚˜ ë©”ë‰´ë¥¼ ë§ì”€í•˜ì‹œë©´ ì™€ì¸ì„ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤.")

# 3. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
def get_data():
    df = pd.read_csv(GOOGLE_SHEET_CSV_URL)
    return df

# 4. ì§ˆë¬¸ ì°½
query = st.text_input("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”", placeholder="ì˜ˆ: 3ë§Œì›ëŒ€ ìŠ¤í…Œì´í¬ì™€ ì–´ìš¸ë¦¬ëŠ” ë ˆë“œì™€ì¸?")

if query:
    with st.spinner('ì¬ê³ ë¥¼ í™•ì¸í•˜ë©° ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë½‘ëŠ” ì¤‘ì…ë‹ˆë‹¤...'):
        df = get_data()
        inventory_str = df.to_string(index=False)
        
        # ì œë¯¸ë‚˜ì´ì—ê²Œ ì§ˆë¬¸
        model = genai.GenerativeModel("gemini-1.5-flash") # í˜¹ì€ gemini-3-flash-preview
        prompt = f"ë„ˆëŠ” ì†Œë¯ˆë¦¬ì—ì•¼. ì•„ë˜ ì¬ê³ ë¥¼ ë³´ê³  ì§ˆë¬¸ì— ì¹œì ˆí•˜ê²Œ ë‹µí•´ì¤˜.\nì¬ê³ :\n{inventory_str}\nì§ˆë¬¸: {query}"
        
        response = model.generate_content(prompt)
        
        # ë‹µë³€ ì¶œë ¥ (ì˜ˆìœ ë°•ìŠ¤ í˜•íƒœ)
        st.success("âœ¨ AI ì†Œë¯ˆë¦¬ì—ì˜ ì¶”ì²œ ê²°ê³¼")
        st.write(response.text)

# í•˜ë‹¨ ì •ë³´
st.divider()
st.caption("ì‹¤ì‹œê°„ ì¬ê³  í˜„í™©ì„ ë°”íƒ•ìœ¼ë¡œ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.")